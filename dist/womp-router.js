import{createContext as W,defineWomp as P,lazy as H,useCallback as O,useContext as y,useEffect as j,useMemo as C,useState as F,Suspense as v,html as x}from"womp";const w=(t,e=[],n=null,r=[])=>(t.forEach(a=>{if(a instanceof Route.class){const o=a.props,c=o.lazy?H(o.lazy):null,h={...o,parent:n,element:o.element,path:o.path,lazy:c,fallback:o.fallback,index:null,children:[]};c&&r.push(c),o.index&&(n.index=h),e.push(h),w(a.childNodes,h.children,h,r)}}),[e,r]),$=(t,e=[],n="")=>{for(const r of t){let a="";if(r.path){const o=n&&!n.endsWith("/")||!n&&!r.path.startsWith("/")?"/":"";a+=n+o+r.path,e.push([a,r])}r.children&&$(r.children,e,a)}return e},L=t=>{const e=Object.keys(t);return e.sort((n,r)=>{const a=t[n],o=t[r],c=Object.keys(a).filter(s=>s!=="segments").length,i=Object.keys(o).filter(s=>s!=="segments").length-c;if(i===0){let s=n.split("/"),p=r.split("/");const m=p.length-s.length;if(m!==0)return m;let d=0,u=0;for(let l=0;l<s.length;l++){const k=s[l],f=p[l];if(k.startsWith(":")||d++,f.startsWith(":")||u++,k.startsWith(":")||f.startsWith(":")||k.startsWith("*")||f.startsWith("*"))break}return u-d}return i}),t[e[0]]},z=(t,e)=>{const n={exact:null,parametric:{},fallbacks:{}},r=e!=="/"&&e.endsWith("/")?e.substring(0,e.length-1):e;for(const i of t){const[s,p]=i,m=s.endsWith("*");if(!m&&s.split("/").length!==r.split("/").length)continue;if(s===r){n.exact=p;break}if(!s.includes(":")&&!s.includes("*"))continue;const d=s.split("/");let u="";const l=[];for(let g=1;g<d.length;g++){const R=d[g];u+="\\/",R.startsWith(":")?(g===d.length-1?u+="(.*)":u+="(.*?)",l.push(R.substring(1))):R==="*"?(u+="(.*)",l.push("segments")):u+=R}const f=new RegExp(u,"g").exec(r);if(f){const g={};for(let R=1;R<f.length;R++)g[l[R-1]]=f[R];m?n.fallbacks[s]=[p,g]:n.parametric[s]=[p,g]}}const a=Object.keys(n.parametric),o=Object.keys(n.fallbacks);let c=[null,null];n.exact?c=[n.exact,{}]:a.length?c=L(n.parametric):o.length&&(c=L(n.fallbacks));const h=c[0]?.redirect||c[0]?.index?.redirect;if(h){const i=N(e,h);history.replaceState({},void 0,i),c=z(t,i)}return c},N=(t,e)=>e.startsWith("/")?e:t+(t.endsWith("/")||e.startsWith("#")?"":"/")+e,A=t=>t?x`
		<${b.Provider} value=${{...t}}>
			${t.lazy?t.fallback?x`
							<${v} fallback=${t.fallback}>
								<${t.lazy} />
							</${v}>
						`:x`<${t.lazy} />`:t.element}
		</${b.Provider}>
	`:null,S=W({params:null,hash:null,currentRoute:null,setNewRoute:null}),B=t=>{if(t){const e=document.getElementById(t);e&&e.scrollIntoView({block:"start",behavior:"smooth"})}};export function Routes({children:t}){const[e,n]=F(window.location.pathname),r=O((m,d=!0)=>{n(u=>{const l=N(u,m),[k,f]=l.split("#");return d&&u!==l&&(history.pushState({},null,l),f||window.scrollTo(0,0)),B(f),k})}),a=C(()=>{const[m,d]=w(t.nodes);return m},[]),o=C(()=>$(a),[]);j(()=>{window.addEventListener("popstate",()=>{r(window.location.pathname,!1)}),setTimeout(()=>{B(i.hash)},200)},[]);const[c,h]=z(o,e),i=C(()=>({hash:window.location.hash.split("#")[1],params:h,currentRoute:e,setNewRoute:r}),[e]);let s=c??{notFound:!0},p=null;for(s.nextRoute=p;s.parent;)p=s,s=s.parent,s.nextRoute=p;return x`<${S.Provider} value=${i}>
		${s.notFound?x`<div>Not found!</div>`:A(s)}
	</${S.Provider}>`}P(Routes,{name:"womp-routes"});const b=W(null);export function Route({route:t}){return x``}P(Route,{name:"womp-route"});export function ChildRoute(){const t=y(b);let e=null;if(t){const n=t.nextRoute;n?e=n:t.index&&(e=t.index)}return A(e)}P(ChildRoute,{name:"womp-child-route"});const E=(t,e)=>{let n=t;if(!n.startsWith("/")&&!n.startsWith("#")){let r=e;for(;r;){const a=r.path;if(a){const o=a.endsWith("/")?"":"/";n=r.path+o+n}r=r.parent}}return n};export function Link({to:t,children:e}){const n=useNavigate(),r=y(b),a=E(t,r);return x`<a href=${a} @click=${c=>{c.preventDefault(),n(a)}}>${e}</a> `}Link.css=":host { display: inline-block; }",P(Link,{name:"womp-link"});export function NavLink({to:t,children:e}){const n=useNavigate(),r=useCurrentRoute(),a=y(b),o=E(t,a);return x`<a class=${r===o&&"active"} href=${o} @click=${i=>{i.preventDefault(),n(o)}}>${e}</a>`}NavLink.css=":host { display: inline-block; }",P(NavLink,{name:"womp-nav-link"});export const useParams=()=>y(S).params,useNavigate=()=>y(S).setNewRoute,useCurrentRoute=()=>y(S).currentRoute;
